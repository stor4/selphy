(function() {
  'use strict';

  function meanmenu(options) {
      var defaults = {
          meanMenuTarget: document.querySelector(this),
          meanMenuContainer: 'body',
          meanMenuClose: 'X',
          meanMenuCloseSize: '18px',
          meanMenuOpen: '<span /><span /><span />',
          meanRevealPosition: 'right',
          meanRevealPositionDistance: '0',
          meanRevealColour: '',
          meanScreenWidth: 480,
          meanNavPush: '',
          meanShowChildren: true,
          meanExpandableChildren: true,
          meanExpand: '+',
          meanContract: '-',
          meanRemoveAttrs: false,
          onePage: false,
          meanDisplay: 'block',
          removeElements: ''
      };

      options = Object.assign({}, defaults, options);

      var meanMenuTarget = options.meanMenuTarget,
          meanMenuContainer = options.meanMenuContainer,
          meanMenuClose = options.meanMenuClose,
          meanMenuCloseSize = options.meanMenuCloseSize,
          meanMenuOpen = options.meanMenuOpen,
          meanRevealPosition = options.meanRevealPosition,
          meanRevealPositionDistance = options.meanRevealPositionDistance,
          meanRevealColour = options.meanRevealColour,
          meanScreenWidth = options.meanScreenWidth,
          meanNavPush = options.meanNavPush,
          meanShowChildren = options.meanShowChildren,
          meanExpandableChildren = options.meanExpandableChildren,
          meanExpand = options.meanExpand,
          meanContract = options.meanContract,
          meanRemoveAttrs = options.meanRemoveAttrs,
          onePage = options.onePage,
          meanDisplay = options.meanDisplay,
          removeElements = options.removeElements;

      var currentWidth = window.innerWidth || document.documentElement.clientWidth;

      var isMobile = /iPhone|iPad|iPod|Android|Blackberry|Windows Phone/i.test(navigator.userAgent);

      var meanContainer = document.querySelector(meanMenuContainer);
      var meanMenuHtml = meanMenuTarget.innerHTML;

      var meanRevealPositionStyle = '';
      if (meanRevealPosition === 'right') {
          meanRevealPositionStyle = 'right:' + meanRevealPositionDistance + '; left:auto;';
      } else if (meanRevealPosition === 'left') {
          meanRevealPositionStyle = 'left:' + meanRevealPositionDistance + '; right:auto;';
      }

      function showMenu() {
          if (currentWidth <= meanScreenWidth) {
              meanContainer.classList.add('mean-container');
              var meanBar = document.createElement('div');
              meanBar.className = 'mean-bar';
              var meanReveal = document.createElement('a');
              meanReveal.className = 'meanmenu-reveal';
              meanReveal.style = 'background:' + meanRevealColour + '; color:' + meanRevealColour + '; ' + meanRevealPositionStyle;
              meanReveal.innerHTML = 'Show Navigation';
              meanBar.appendChild(meanReveal);
              meanContainer.insertBefore(meanBar, meanContainer.firstChild);

              var meanNav = document.createElement('nav');
              meanNav.className = 'mean-nav';
              meanNav.innerHTML = meanMenuHtml;
              meanBar.appendChild(meanNav);

              if (meanRemoveAttrs) {
                  meanNav.querySelectorAll('ul, ul *').forEach(function(el) {
                      el.removeAttribute('class');
                      el.removeAttribute('id');
                  });
              }

              var meanPush = document.createElement('div');
              meanPush.className = 'mean-push';
              meanPush.style.marginTop = meanNavPush;
              meanMenuTarget.parentNode.insertBefore(meanPush, meanMenuTarget);
              meanMenuTarget.style.display = 'none';

              meanReveal.addEventListener('click', function(e) {
                  e.preventDefault();
                  if (meanNav.style.display === 'block') {
                      meanNav.style.display = 'none';
                  } else {
                      meanNav.style.display = 'block';
                  }
              });

              if (meanShowChildren && meanExpandableChildren) {
                  meanNav.querySelectorAll('ul ul').forEach(function(subMenu) {
                      var expandLink = document.createElement('a');
                      expandLink.className = 'mean-expand';
                      expandLink.href = '#';
                      expandLink.style.fontSize = meanMenuCloseSize;
                      expandLink.innerHTML = meanExpand;
                      subMenu.parentNode.insertBefore(expandLink, subMenu);
                      expandLink.addEventListener('click', function(e) {
                          e.preventDefault();
                          if (subMenu.style.display === 'block') {
                              subMenu.style.display = 'none';
                              expandLink.innerHTML = meanExpand;
                          } else {
                              subMenu.style.display = 'block';
                              expandLink.innerHTML = meanContract;
                          }
                      });
                  });
              }
          } else {
              resetMenu();
          }
      }

      function resetMenu() {
          document.querySelectorAll('.mean-bar, .mean-push').forEach(function(el) {
              el.remove();
          });
          meanContainer.classList.remove('mean-container');
          meanMenuTarget.style.display = meanDisplay;
      }

      window.addEventListener('resize', function() {
          currentWidth = window.innerWidth || document.documentElement.clientWidth;
          showMenu();
      });

      showMenu();
  }

  window.meanmenu = meanmenu;
})();

// document.addEventListener("DOMContentLoaded", function () {
//   // Инициализация меню
//   // console.log('test')
//   meanmenuInit({
//       meanMenuTarget: document.querySelector('.category-menu'),
//       meanMenuContainer: document.body,
//       meanScreenWidth: 768 // Примерная ширина, при которой сработает мобильное меню
//   });

//   function meanmenuInit(options) {
//       var meanMenuTarget = options.meanMenuTarget;
//       var meanMenuContainer = options.meanMenuContainer;
//       var meanScreenWidth = options.meanScreenWidth;

//       // Проверка ширины экрана
//       if (window.innerWidth <= meanScreenWidth) {
//           meanMenuTarget.classList.add('active-menu');
//           setupMeanMenu(meanMenuTarget);
//       }

//       // Переписываем логику скрытия/отображения подменю
//       function setupMeanMenu(menu) {
//           var items = menu.querySelectorAll('li > a');

//           items.forEach(function (item) {
//               item.addEventListener('click', function (e) {
//                   var subMenu = this.nextElementSibling;

//                   if (subMenu && subMenu.classList.contains('mega-menu-ul')) {
//                       e.preventDefault();
//                       subMenu.classList.toggle('open');
//                   }
//               });
//           });
//       }

//       // Прослушивание изменения размеров экрана
//       window.addEventListener('resize', function () {
//           if (window.innerWidth <= meanScreenWidth) {
//               meanMenuTarget.classList.add('active-menu');
//           } else {
//               meanMenuTarget.classList.remove('active-menu');
//           }
//       });
//   }
// });




