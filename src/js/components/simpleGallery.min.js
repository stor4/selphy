(function() {
  function simpleGallery(thumbnails, options) {
      const settings = Object.assign({
          thumbnailAnchor: ".simpleLens-thumbnail-wrapper",
          bigImageClass: "simpleLens-big-image",
          lensImageAttr: "data-lens-image",
          bigImageAttr: "data-big-image",
          parentAnchorClass: "simpleLens-lens-image",
          galleryContainer: ".simpleLens-gallery-container",
          bigImageContainer: ".simpleLens-big-image-container",
          loadingImage: "images/loading.gif",
          showEvent: "mouseenter"
      }, options);

      if (thumbnails.length === 0) {
          console.log("There are no thumbnails in the gallery");
          return false;
      }

      thumbnails.forEach(function(thumbnail) {
          const img = new Image();
          img.src = thumbnail.getAttribute('rel');
      });

      thumbnails.forEach(function(thumbnail) {
          thumbnail.addEventListener(settings.showEvent, function() {
              const parent = thumbnail.closest(settings.thumbnailAnchor);
              const bigImageSrc = parent.getAttribute(settings.bigImageAttr);
              const lensImageSrc = parent.getAttribute(settings.lensImageAttr);
              const bigImageContainer = parent.closest(settings.galleryContainer).querySelector(settings.bigImageContainer);

              const loadingImg = new Image();
              loadingImg.src = settings.loadingImage;
              bigImageContainer.innerHTML = '';
              bigImageContainer.appendChild(loadingImg);

              const anchor = document.createElement('a');
              anchor.setAttribute('data-lens-image', lensImageSrc);
              anchor.classList.add(settings.parentAnchorClass);

              const bigImage = new Image();
              bigImage.src = bigImageSrc;
              bigImage.classList.add(settings.bigImageClass);
              bigImage.onload = function() {
                  anchor.appendChild(bigImage);
                  bigImageContainer.innerHTML = '';
                  bigImageContainer.appendChild(anchor);
              };
          });
      });
  }

  // Expose function to global scope
  window.simpleGallery = simpleGallery;
})();
